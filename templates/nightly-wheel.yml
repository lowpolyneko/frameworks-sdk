# Nightly wheel job template for in-repo scripts
spec:
  inputs:
    wheel:
      description: Wheel to build
    flags:
      default: ''
      description: Flags to pass to build script
    needs:
      type: array
      default: []
      description: Dependencies to wait for
---

$[[ inputs.wheel ]]:
  stage: build
  extends: .common-runner
  variables:
    # build in /tmp instead of on Lustre
    BUILD_ROOT: "/tmp/frameworks-nightly/builds"
    # where to collect logs and wheels on Lustre
    REMOTE_ROOT: "/lus/flare/projects/datascience/ewong25/.frameworks-nightly"
  needs: $[[ inputs.needs ]]
  script:
    - cd nightly_wheels
    - ./$[[ inputs.wheel ]] $[[ inputs.flags ]]
  artifacts:
    when: always
    expire_in: never
    paths:
      - "**/$[[ inputs.wheel ]]*.whl"
